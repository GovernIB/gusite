<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>

<query name="es.caib.gusite.micromodel.PersonalizacionPlantilla.searchByMicrosite"><![CDATA[ 
FROM PersonalizacionPlantilla pp
WHERE
	pp.id IN(
	SELECT 
		p.id
	FROM 
		PersonalizacionPlantilla p
	WHERE
		p.microsite.id = :microsite
	) OR pp.id IN (
	SELECT 
		p.id
	FROM 
		Microsite m
		left outer join
			m.tema.personalizacionesPlantilla as p
	WHERE
		m.id = :microsite 
	) OR pp.id IN (
	SELECT 
		p.id
	FROM 
		Microsite m
		left outer join
			m.tema.temaPadre.personalizacionesPlantilla as p
	WHERE
		m.id = :microsite 
	)
order by 
	pp.plantilla.nombre,
	pp.microsite.id,
	pp.tema.id,
	pp.orden	]]>
	<query-param name="microsite" type="java.lang.Long" />
</query>


<query name="es.caib.gusite.micromodel.PersonalizacionPlantilla.searchByMicrositePlantilla"><![CDATA[ 
FROM PersonalizacionPlantilla pp
WHERE
	pp.id IN(
	SELECT 
		p.id
	FROM 
		PersonalizacionPlantilla p
	WHERE
		p.microsite.id = :microsite AND
		p.plantilla.nombre = :plantilla
	) OR pp.id IN (
	SELECT 
		p.id
	FROM 
		Microsite m
		left outer join
			m.tema.personalizacionesPlantilla as p
	WHERE
		m.id = :microsite AND
		p.plantilla.nombre = :plantilla 
	) OR pp.id IN (
	SELECT 
		p.id
	FROM 
		Microsite m
		left outer join
			m.tema.temaPadre.personalizacionesPlantilla as p
	WHERE
		m.id = :microsite AND
		p.plantilla.nombre = :plantilla 
	)
order by 
	pp.plantilla.nombre,
	pp.microsite.id,
	pp.tema.id,
	pp.orden	]]>
	<query-param name="microsite" type="java.lang.Long" />
	<query-param name="plantilla" type="java.lang.String" />
</query>

</hibernate-mapping>
