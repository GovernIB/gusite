<!DOCTYPE html>
<!--
Descripción: 
Este código muestra la tabla con el calendario.

Variables: 
	MVS_home_datos_noticias_listado: devuelve el listado de noticias
	MVS_home_idmicrosite: devuelve el id del microsite en cuestión
	MVS_datos_agenda_calendario: devuelve los datos del calendario
	
Objetos:
	#gusuri.listarAgendaFecha(MVS_microsite,MVS_idioma,i.finicio): devuelve la URL hacia el acto que se ejecutará en la fecha en cuestión
	#gusuri.listarAgendaFechaFormateada(MVS_microsite,MVS_idioma,valorDatos.value): devuelve la URL hacia el evento con la fecha en cuestión
-->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!--  Este .css se usa para que en estático aparezca lo más parecido posible a la versión dinámica.
Al ejecutarse dinámicamente, se eliminará automáticamente el .css -->
<link rel="stylesheet" type="text/css" media="all"
	href="resources/css/estils.css" th:href="@{/resources/css/estils.css}" th:remove="all"></link>
</head>
<body>
	<div th:fragment="listado">
		<div th:with="gc=${#calendars.createNow()}" th:remove="tag">
			<!--  retrocedemos 2 meses-->
			<div th:with="anteriorMes=(${#calendars.month(gc)}-2)"
				th:remove="tag">
				<div id="agendaLlistat">
					<!--MVS_home_datos_noticias_listado devuelve el listado de noticias-->
					<div th:if="${#lists.size(MVS_home_datos_agenda_listado)} !=0"
						th:remove="tag">
						<p>
							<strong th:text="#{microhtml.proximosactos} + ':'">Próxims
								actes programats</strong>
						</p>
						<ul>
							<li th:remove="tag">
								<ul th:each="i : ${MVS_home_datos_agenda_listado}"
									th:remove="tag">
									<li
										th:with="midia=${#calendars.format(i.finicio,'dd/MM/yyyy')},mihora=${#calendars.format(i.finicio,'HH:mm')}">
										<div th:text="${midia}" th:remove="tag"></div>
										<div th:if="${mihora} !='00:00'"
											th:text="#{agenda.cuando}+ ' ' + ${mihora}" th:remove="tag">
										</div> <br />
										<div th:each="traduccionIdioma:${i.traducciones}"
											th:remove="tag">
											<!-- #gusuri.listarAgendaFecha(MVS_microsite,MVS_idioma,i.finicio) devuelve la URL hacia el acto que se ejecutará en la fecha en cuestión -->
											<a
												th:href="@{${#gusuri.listarAgendaFecha(MVS_microsite,MVS_idioma,i.finicio)}}"
												th:text="${traduccionIdioma.value.titulo}"></a>
										</div>
									</li>
								</ul>
							</li>
						</ul>
					</div>
					<div th:if="${#lists.size(MVS_home_datos_agenda_listado)} ==0"
						th:remove="tag">
						<p th:text="#{microhtml.noactos}">No hi ha cap acte programat</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div th:fragment="calendario">
		<div th:with="gc=${#calendars.createNow()}" th:remove="tag">
			<!-- Establecemos el valor al día  -->
			<div th:with="DayOfMonth=1" th:remove="tag">
				<div th:with="nummesesaretroceder=2" th:remove="tag">
					<!-- retrocedemos 2 meses -->
					<div th:with="anteriorMes=(${#calendars.month(gc)}-2)"
						th:remove="tag">
						<!-- (Inici JOG Feb 2013). Cas especial microsite: 2013 Any Juniper Serra (idsite = 4445) -->
						<!-- MVS_home_idmicrosite: devuelve el id del microsite en cuestión -->
						<div th:if="${MVS_home_idmicrosite}==4445" th:remove="tag">
							<div th:with="gc1=${#calendars.createNow()}" th:remove="tag">
								<div th:with="mesact=(${#calendars.month(gc1)}+1)"
									th:remove="tag">
									<div th:with="nummesesaretroceder=(${mesact}+13)"
										th:remove="tag">
										<div
											th:each="i : ${#numbers.sequence( 2, nummesesaretroceder)}"
											th:remove="tag">

											<div th:with="anteriorMes=(${#calendars.month(gc)}-${i})"
												th:remove="tag"></div>
										</div>
										<div th:with="nummeses=(26-${nummesesaretroceder})"
											th:remove="tag"></div>
									</div>
								</div>
							</div>
						</div>
						<!-- (Fi JOG) -->
						<div
							th:with="gc=${#calendars.create(#calendars.year(gc),anteriorMes,DayOfMonth,#calendars.hour(gc),#calendars.minute(gc))}"
							th:remove="tag">
							<!-- getSelectoragenda -->
							<div
								th:with="gi=${#calendars.create(#calendars.year(gc),#calendars.month(gc),#calendars.day(gc),#calendars.hour(gc),#calendars.minute(gc))}"
								th:remove="tag">
								<div th:with="DayOfMonthgi=1" th:remove="tag">
									<p
										th:with="gi=${#calendars.create(#calendars.year(gi),#calendars.month(gi),DayOfMonthgi,#calendars.hour(gi),#calendars.minute(gi))}">
										<span th:text="#{calendario.mostrarmes} + ':'" th:remove="tag"></span><br />
										<select onchange="mostrarCalendari();" name="agendaSelect"
											id="agendaSelect"
											th:with="nummeses=3 + ${nummesesaretroceder}">
											<div th:each="i : ${#numbers.sequence( 0, nummeses-1)}"
												th:remove="tag">
												<div th:if="${i} !=0" th:remove="tag">
													<div th:with="siguienteMes=${#calendars.month(gi)}"
														th:remove="tag">
														<div
															th:with="gi=${#calendars.create(#calendars.year(gi),siguienteMes,#calendars.day(gi),#calendars.hour(gi),#calendars.minute(gi))}"
															th:remove="tag">
															<div th:unless="((${siguienteMes}+ ${i})>12)" th:remove="tag">
															<div th:if="${i}==${nummesesaretroceder}" th:remove="tag"
																th:with="calendarioMes='calendario.mes.'+ (${siguienteMes}+ ${i})">
																<option th:selected="selected" th:value="${i}"
																	th:text="#{${calendarioMes}}+ ' ' + ${#calendars.year(gi)}"></option>
															</div>
															<div th:if="${i}!=${nummesesaretroceder}" th:remove="tag"
																th:with="calendarioMes='calendario.mes.'+ (${siguienteMes}+ ${i})">
																<option th:value="${i}"
																	th:text="#{${calendarioMes}}+ ' ' + ${#calendars.year(gi)}"></option>
															</div>
															</div>
															<div th:if="((${siguienteMes}+ ${i})>12)" th:remove="tag">
															<div>
																<div th:with="calendarioMes='calendario.mes.'+ ((${siguienteMes}+ ${i})-12)" th:remove="tag">
																	<option th:value="${i}"
																	th:text="#{${calendarioMes}}+ ' ' + (${#calendars.year(gi)}+1)"></option>
																</div>
															</div>
															</div>
														</div>
													</div>
												</div>
												<div th:if="${i} ==0" th:remove="tag"
													th:with="calendarioMes='calendario.mes.'+(${#calendars.month(gi)}+ ${i})">
													<option th:value="${i}"
														th:text="#{${calendarioMes}}+ ' ' + ${#calendars.year(gi)}"></option>
												</div>
											</div>
										</select>
									</p>
								</div>
							</div>
							<!-- fi getSelectoragenda -->
							<div id="agendaCalendaris"
								th:with="nummeses=3 + ${nummesesaretroceder}">
								<span th:each="i : ${#numbers.sequence(1, nummeses)}"
									th:remove="tag">
									<div th:if="${i}==(${nummesesaretroceder}+1)">
										<span
											th:with="anyo=${#calendars.year(gc)},mes=(${#calendars.month(gc)}+${i})"
											th:remove="tag" th:fragment="tablaCalendario"> <span th:unless="(${mes}-1)>12" 
											th:switch="(${mes}-1)" class="tituloMes"> <span
												th:case="1" th:text="#{calendario.enero} + ' ' + ${anyo}"
												th:remove="tag">Enero Año</span> <span th:case="2"
												th:text="#{calendario.febrero} + ' ' + ${anyo}"
												th:remove="tag">Febrero Año</span> <span th:case="3"
												th:text="#{calendario.marzo} + ' ' + ${anyo}"
												th:remove="tag">Marzo Año</span> <span th:case="4"
												th:text="#{calendario.abril} + ' ' + ${anyo}"
												th:remove="tag">Abril Año</span> <span th:case="5"
												th:text="#{calendario.mayo} + ' ' + ${anyo}" th:remove="tag">Mayo
													Año</span> <span th:case="6"
												th:text="#{calendario.junio} + ' ' + ${anyo}"
												th:remove="tag">Junio Año</span> <span th:case="7"
												th:text="#{calendario.julio} + ' ' + ${anyo}"
												th:remove="tag">Julio Año</span> <span th:case="8"
												th:text="#{calendario.agosto} + ' ' + ${anyo}"
												th:remove="tag">Agosto Año</span> <span th:case="9"
												th:text="#{calendario.septiembre} + ' ' + ${anyo}"
												th:remove="tag">Septiembre Año</span> <span th:case="10"
												th:text="#{calendario.octubre} + ' ' + ${anyo}"
												th:remove="tag">Octubre Año</span> <span th:case="11"
												th:text="#{calendario.noviembre} + ' ' + ${anyo}"
												th:remove="tag">Noviembre Año</span> <span th:case="12"
												th:text="#{calendario.diciembre} + ' ' + ${anyo}"
												th:remove="tag">Diciembre Año</span>
										</span>
										<span th:if="(${mes}-1)>12" th:switch="((${mes}-1)-12)" class="tituloMes" th:with="anyo=(${anyo}+1)"> 
											<span
												th:case="1" th:text="#{calendario.enero} + ' ' + ${anyo}"
												th:remove="tag">Enero Año</span> <span th:case="2"
												th:text="#{calendario.febrero} + ' ' + ${anyo}"
												th:remove="tag">Febrero Año</span> <span th:case="3"
												th:text="#{calendario.marzo} + ' ' + ${anyo}"
												th:remove="tag">Marzo Año</span> <span th:case="4"
												th:text="#{calendario.abril} + ' ' + ${anyo}"
												th:remove="tag">Abril Año</span> <span th:case="5"
												th:text="#{calendario.mayo} + ' ' + ${anyo}" th:remove="tag">Mayo
													Año</span> <span th:case="6"
												th:text="#{calendario.junio} + ' ' + ${anyo}"
												th:remove="tag">Junio Año</span> <span th:case="7"
												th:text="#{calendario.julio} + ' ' + ${anyo}"
												th:remove="tag">Julio Año</span> <span th:case="8"
												th:text="#{calendario.agosto} + ' ' + ${anyo}"
												th:remove="tag">Agosto Año</span> <span th:case="9"
												th:text="#{calendario.septiembre} + ' ' + ${anyo}"
												th:remove="tag">Septiembre Año</span> <span th:case="10"
												th:text="#{calendario.octubre} + ' ' + ${anyo}"
												th:remove="tag">Octubre Año</span> <span th:case="11"
												th:text="#{calendario.noviembre} + ' ' + ${anyo}"
												th:remove="tag">Noviembre Año</span> <span th:case="12"
												th:text="#{calendario.diciembre} + ' ' + ${anyo}"
												th:remove="tag">Diciembre Año</span>
										</span>
											<table class="calendariTabla">
												<caption class="captionSummaryTable"
													th:text="#{calendario.sumario}">Dies del mes on
													haurà qualque acte</caption>
												<tr>
													<th scope="col"><abbr th:title="#{calendario.lunes}"
														title="Dilluns" th:text="#{calendario.lunes.abrv}">Dl</abbr>
													</th>
													<th scope="col"><abbr th:title="#{calendario.martes}"
														title="Dimarts" th:text="#{calendario.martes.abrv}">Dm</abbr>
													</th>
													<th scope="col"><abbr
														th:title="#{calendario.miercoles}" title="Dimecres"
														th:text="#{calendario.miercoles.abrv}">Dc</abbr></th>
													<th scope="col"><abbr th:title="#{calendario.jueves}"
														title="Dijous" th:text="#{calendario.jueves.abrv}">Dj</abbr>
													</th>
													<th scope="col"><abbr th:title="#{calendario.viernes}"
														title="Divendres" th:text="#{calendario.viernes.abrv}">Dv</abbr>
													</th>
													<th scope="col"><abbr th:title="#{calendario.sabado}"
														title="Dissabte" th:text="#{calendario.sabado.abrv}">Ds</abbr>
													</th>
													<th scope="col"><abbr th:title="#{calendario.domingo}"
														title="Diumenge" th:text="#{calendario.domingo.abrv}">Dg</abbr>
													</th>
												</tr>
												<span
													th:with="mes=(${mes}-1),cf=${#calendars.create(anyo,mes,1,0,0,0)}"
													th:remove="tag"> <span
													th:with="diadelasemana=(${#calendars.dayOfWeek(cf)}-1)"
													th:remove="tag"> <span th:if="${diadelasemana}==0"
														th:remove="tag"> <span th:with="diadelasemana=7"
															th:remove="tag"> <span th:switch="${mes}"
																th:remove="tag" th:fragment="contenidoTabla"> <span
																	th:case="2" th:remove="tag"> <span
																		th:if="((${anyo} % 100 == 0) and (${anyo} % 400 == 0)) or ((${anyo} % 100 != 0) and (${anyo} % 4 == 0))"
																		th:with="diasmes=29" th:remove="tag">
																			<tr th:replace="agendaCalendarListado :: filasTabla"></tr>
																	</span> <span
																		th:if="((${anyo} % 100 == 0) and (${anyo} % 400 != 0)) or ((${anyo} % 100 != 0) and (${anyo} % 4 != 0))"
																		th:with="diasmes=28" th:remove="tag">
																			<tr th:replace="agendaCalendarListado :: filasTabla"></tr>
																	</span>
																</span> <span th:case="*" th:remove="tag"> <span
																		th:if="(${mes}==4) or (${mes}==6) or (${mes}==9) or (${mes}==11)"
																		th:with="diasmes=30" th:remove="tag">
																			<tr th:fragment="filasTabla">
																				<span
																					th:each="i,iterStat : ${#numbers.sequence(1, diadelasemana-1)}"
																					th:with="indice=${iterStat.last},cuentadias=1"
																					th:remove="tag"> <span
																					th:with="cuentadias=(${cuentadias}+${i})"
																					th:remove="tag"> <!-- Utilizo esta condicion ""(${diadelasemana}==1)==true ? all : tag"" pq si el dia es 1
		  							 												quiere decir que es lunes, por lo tanto no es necesario dejar casillas vacias al inicio de -->
																						<span
																						th:remove="(${diadelasemana}==1)==true ? all : tag">
																							<td></td>
																					</span> <span th:if="${indice}==true" th:remove="tag">
																							<span
																							th:each="j,iterStat : ${#numbers.sequence(1, diasmes)}"
																							th:with="primerValor=${iterStat.first}"
																							th:remove="tag"> <!-- MVS_datos_agenda_calendario devuelve los datos del calendario -->
																								<span
																								th:if="${MVS_datos_agenda_calendario}!=null"
																								th:remove="tag"> <span
																									th:each="datosAnos, itera:${MVS_datos_agenda_calendario}"
																									th:remove="tag"> <span
																										th:if="${datosAnos.key}==(${anyo}+ '-' + ${mes})"
																										th:remove="tag"> <span
																											th:each="valorDatos, iter:${datosAnos.value}"
																											th:with="cuentaDato=${iter.count}, tamanoDato=${iter.size}"
																											th:remove="tag"> 
																											<span
																												th:if="${j}!=${valorDatos.key}"
																												th:remove="tag"> <span
																													th:if="(${j} gt ${valorDatos.key}) and (${cuentaDato==1})"
																													th:remove="tag">
																														 <td class="NoActe noEvento" th:text="${j}"></td>
																												</span> <span
																													th:remove="(${cuentaDato} != ${tamanoDato})==true ? all : tag">
																														<span
																														th:remove="(${j} gt ${valorDatos.key})==true ? all : tag">
																															<td class="NoActe noEvento" th:text="${j}"></td>	
																													</span>
																												</span>
																											</span> 
																											<span th:if="${j}==${valorDatos.key}"
																												th:remove="tag"> <!-- #gusuri.listarAgendaFechaFormateada(MVS_microsite,MVS_idioma,valorDatos.value) devuelve la URL hacia el evento con la fecha en cuestión -->
																													<td class="acte evento"><a
																														th:href="@{${#gusuri.listarAgendaFechaFormateada(MVS_microsite,MVS_idioma,valorDatos.value)}}"
																														th:text="${j}" /></td>
																											</span>
																										</span> <span
																											th:if="${#maps.isEmpty(datosAnos.value)}"
																											th:remove="tag">
																												<td th:text="${j}"></td>
																										</span>
																									</span>
																								</span>
																							</span> <!-- MVS_datos_agenda_calendario devuelve los datos del calendario -->
																								<span
																								th:if="${MVS_datos_agenda_calendario}==null"
																								th:remove="tag">
																									<td th:text="${j}"></td>
																							</span> <span th:switch="${primerValor}" th:remove="tag">
																									<span th:case="false"
																									th:with="cuentadias=(${cuentadias}+(${j}-1))"
																									th:remove="tag"> <span
																										th:if="(${cuentadias}% 7) == 0"
																										th:with="cuentapares=1" th:remove="tag"
																										th:fragment="pares">
																											<tr></tr> <span
																											th:with="cuentapares=(${cuentapares}+${j})"
																											th:remove="tag"> <span
																												th:if="(${cuentapares}% 2) ==0"
																												th:remove="tag"> <script>
																													jQuery(
																															document)
																															.ready(
																																	function() {
																																		var filapar = jQuery('.filapar');

																																		var par = jQuery('.filapar + tr');

																																		par
																																				.attr(
																																						'class',
																																						'par');

																																		filapar
																																				.detach();
																																	});
																												</script>
																													<tr class="filapar"></tr>
																											</span>
																										</span>
																									</span>
																								</span> <span th:case="true" th:remove="tag"> <span
																										th:replace="agendaCalendarListado :: pares"
																										th:remove="tag"> </span>
																								</span>
																							</span>
																						</span>
																					</span>
																				</span>
																				</span>
																			</tr>
																	</span> 
																	<span
																		th:if="(${mes}!=4) and (${mes}!=6) and (${mes}!=9) and (${mes}!=11)"
																		th:with="diasmes=31" th:remove="tag">
																			<tr th:replace="agendaCalendarListado :: filasTabla"></tr>
																	</span>
																</span>
															</span>
														</span>
													</span> <span th:if="${diadelasemana}!=0" th:remove="tag"><span
															th:switch="${mes}" th:remove="tag"
															th:replace="agendaCalendarListado :: contenidoTabla"></span>
													</span>
												</span>
												</span>
											</table>
										</span>
									</div>
									<div th:if="${i}!=(${nummesesaretroceder}+1)"
										style="display: none;">
										<span th:replace="agendaCalendarListado :: tablaCalendario"
											th:remove="tag"> </span>
									</div>
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>